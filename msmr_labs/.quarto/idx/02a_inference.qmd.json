{"title":"Inference for LMM","markdown":{"yaml":{"title":"Inference for LMM","params":{"SHOW_SOLS":false,"TOGGLE":true},"editor_options":{"chunk_output_type":"console"}},"headingText":"Inference","containsRefs":false,"markdown":"\n\n```{r}\n#| label: setup\n#| include: false\nsource('assets/setup.R')\nlibrary(xaringanExtra)\nlibrary(tidyverse)\nlibrary(patchwork)\nxaringanExtra::use_panelset()\n```\n\n\n\nThe term \"inference\" is used to refer to the process of moving from beyond a description of our specific sample to being able to make statements about the broader population from which we have sampled. \n\nIn the framework for statistics that we have been learning, this centers on the idea of _samples statistics that we might see in the long run_ (i.e. if we did the experiment again and again and again with a new sample each time). \n\n```{r}\n#| echo: false\n#| label: fig-se3\n#| fig-cap: \"The standard error is the standard deviation of the 'sampling distribution' - the distribution of sample statistics that we _could_ see. We use this to ask how likely our observed sample is in a universe where the null hypothesis is true. This probability gives us reason to reject (or not) said null hypothesis.\"\nset.seed(2394)\nsamplemeans <- seq(-5,5,.1)\ng <- ggplot(data=tibble(samplemeans),aes(x=samplemeans))+\n  #geom_histogram(alpha=.3)+\n  stat_function(geom=\"line\",fun=~dnorm(.x, mean=0,sd=1),lwd=1)\n\n\nld <- layer_data(g) |> filter(x <= 1 & x >= -1)\nld2 <- layer_data(g) |> filter(x <= 2 & x >= -2)\nld3 <- layer_data(g) |> filter(x >= 2.5)\n\ng + geom_area(data=ld,aes(x=x,y=y),fill=\"grey30\",alpha=.3) + \n  geom_area(data=ld2,aes(x=x,y=y),fill=\"grey30\",alpha=.1) +\n  geom_area(data=ld3,aes(x=x,y=y),fill=\"red\",alpha=.1) +\n  geom_vline(xintercept=2.5,col=\"red\",lty=\"dashed\")+\n  annotate(\"text\",x=2.6,y=.2,label=\"observed\\nsample statistic\",angle=90,col=\"red\",vjust=1)+\n  geom_vline(xintercept = 0, col=\"black\",lty=\"dashed\", lwd=.5) +\n  annotate(\"text\",\n           x=-2, y=.3, \n           label=\"Null Hypothesis\", col=\"black\",\n           hjust=1)+\n  geom_curve(aes(x=-2, xend=0, y=.3, yend=.3), col=\"black\", size=0.5, \n             curvature = 0, arrow = arrow(length = unit(0.03, \"npc\")))+\n  \n  geom_segment(x=0,xend=-1,y=.15,yend=.15) +\n  annotate(\"text\",x=-3, y=.16, label=\"Standard Error (SE)\\n(standard deviation of\\nsampling distribution)\", col=\"grey30\")+\n  geom_curve(aes(x=-3, xend=-.5, y=.18, yend=.15), col=\"grey30\", size=0.5, curvature = -0.5, arrow = arrow(length = unit(0.03, \"npc\")))+\n\n  scale_y_continuous(NULL,breaks=NULL)+\n  theme_minimal()+\n  scale_x_continuous(\"sample means under the null hypothesis\",breaks=NULL) \n  \n  \n\n```\n\nIn USMR, we saw various ways in which this logic was applied, combining the observed sample statistic with the standard error to create a _test statistic_ ($z$, $t$, $\\chi^2$, $F$, then compared to the appropriate standard distribution). \n\nIn the linear models we were making with `lm()`, these were $t$ (for the coefficient estimate) and $F$ (the reduction in residual sums of squares) tests, and accordingly they had an associated degrees of freedom. If we fit a linear model `lm(y~x)` to 10 datapoints, then our tests would have $10-2=8$^[$n$ observations minus $k$ parameters (slope of `x`) minus 1 intercept] degrees of freedom, and test statistics would be compared against, e.g. a $t$ distribution with 8 degrees of freedom. Alternatively, if we fit the same model to 100 datapoints, we would be working with a distribution with 98 degrees of freedom. The degrees of freedom reflects the fact that there is more variability in statistics from smaller samples.  \n\nAnother way of thinking of degrees of freedom is that they are the number of independent datapoints that are left \"free to vary\" around our model parameters. \n\nBut we are now working with multilevel data, and in the scenario where we have, e.g. $n_p$ pupils clustered into $n_s$ schools, how many independent bits of information do we have to begin with? $n_p$? $n_s$? somewhere in between? Our random effects are not \"free to vary\" in the sense that they are estimated under certain constraints (such as following a normal distribution).  \n\nIn very specific situations that correspond to classical experimental designs (in which, e.g., we have perfectly balanced numbers across experimental factors and equal sizes within groups) it is possible to conduct similar $F$ tests (and so $t$ too) with a calculable degrees of freedom. Unfortunately, transferring this to more general scenarios (any missing data, unbalanced designs, more complex random effect structures) is problematic. Partly because defining the degrees of freedom is much more tricky, and partly because the test statistic may not even follow an $F$ distribution with _any_ degrees of freedom.  \n\nHowever, there are various strategies that we can use to conduct inferences that either attempt to approximate the degrees of freedom, or use an alternative method based on, e.g., likelihoods or bootstrapping.  \n\nBelow, we'll go through each method in R, applying it to the following model (recall this is the model we ended with in reading [1B](01b_lmm.html#a-more-complex-model){target=\"_blank\"}).  \n\n```{r}\nlibrary(tidyverse)\nlibrary(lme4)\n\nschoolmot <- read_csv(\"https://uoepsy.github.io/data/schoolmot.csv\")\n\nsmod3 <- lmer(grade ~ motiv * funding + \n                (1 + motiv | schoolid), \n              data = schoolmot)\n```\n\n\n::: {.callout-tip collapse=\"true\"}\n#### df approximations (Satterthwaite & KR)\n\nTwo methods have been suggested as approximations for the denominator degrees of freedom for multilevel models.  \n\n\nsatterthwaite\n\nkr \n```{r}\n#| eval: false\n# ddf ----\nd3=slice_sample(d3,prop=.78)\nm0 =lmer(ACE ~ visit + condition + (1+visit|ppt), d3,REML=F)\nm0r =lmer(ACE ~ visit + condition + (1+visit|ppt), d3,REML=T)\nm1 =lmer(ACE ~ visit * condition + (1+visit|ppt), d3,REML=F)\nm1r =lmer(ACE ~ visit * condition + (1+visit|ppt), d3,REML=T)\nSATmodcomp(m1,m0) # refits with REML\nSATmodcomp(m1r,m0r) # refits with REML\nKRmodcomp(m1,m0) # refits with REML\nKRmodcomp(m1r,m0r) # refits with REML\n\n\nSATmodcomp(m1,m0) # refits with REML\nKRmodcomp(m1,m0) # refits with REML\n\nparameters::model_parameters(m1, ci_method=\"kr\")\n# CIs computed via REML, estimates, t, p not unless initial model fitted with REML\nparameters::model_parameters(m1r,ci_method=\"sat\")\n# CIs computed via REML, estimates, t, p not unless initial model fitted with REML\n```\n\n:::\n\n\n::: {.callout-tip collapse=\"true\"}\n#### likelihood based methods \n\n\n:::\n\n\n\n::: {.callout-tip collapse=\"true\"}\n#### parametric bootstrap\n\n\n:::\n\n\ntable!  \n\n\n\n\n\n\n\n\n\n\n\n\n","srcMarkdownNoYaml":"\n\n```{r}\n#| label: setup\n#| include: false\nsource('assets/setup.R')\nlibrary(xaringanExtra)\nlibrary(tidyverse)\nlibrary(patchwork)\nxaringanExtra::use_panelset()\n```\n\n\n# Inference\n\nThe term \"inference\" is used to refer to the process of moving from beyond a description of our specific sample to being able to make statements about the broader population from which we have sampled. \n\nIn the framework for statistics that we have been learning, this centers on the idea of _samples statistics that we might see in the long run_ (i.e. if we did the experiment again and again and again with a new sample each time). \n\n```{r}\n#| echo: false\n#| label: fig-se3\n#| fig-cap: \"The standard error is the standard deviation of the 'sampling distribution' - the distribution of sample statistics that we _could_ see. We use this to ask how likely our observed sample is in a universe where the null hypothesis is true. This probability gives us reason to reject (or not) said null hypothesis.\"\nset.seed(2394)\nsamplemeans <- seq(-5,5,.1)\ng <- ggplot(data=tibble(samplemeans),aes(x=samplemeans))+\n  #geom_histogram(alpha=.3)+\n  stat_function(geom=\"line\",fun=~dnorm(.x, mean=0,sd=1),lwd=1)\n\n\nld <- layer_data(g) |> filter(x <= 1 & x >= -1)\nld2 <- layer_data(g) |> filter(x <= 2 & x >= -2)\nld3 <- layer_data(g) |> filter(x >= 2.5)\n\ng + geom_area(data=ld,aes(x=x,y=y),fill=\"grey30\",alpha=.3) + \n  geom_area(data=ld2,aes(x=x,y=y),fill=\"grey30\",alpha=.1) +\n  geom_area(data=ld3,aes(x=x,y=y),fill=\"red\",alpha=.1) +\n  geom_vline(xintercept=2.5,col=\"red\",lty=\"dashed\")+\n  annotate(\"text\",x=2.6,y=.2,label=\"observed\\nsample statistic\",angle=90,col=\"red\",vjust=1)+\n  geom_vline(xintercept = 0, col=\"black\",lty=\"dashed\", lwd=.5) +\n  annotate(\"text\",\n           x=-2, y=.3, \n           label=\"Null Hypothesis\", col=\"black\",\n           hjust=1)+\n  geom_curve(aes(x=-2, xend=0, y=.3, yend=.3), col=\"black\", size=0.5, \n             curvature = 0, arrow = arrow(length = unit(0.03, \"npc\")))+\n  \n  geom_segment(x=0,xend=-1,y=.15,yend=.15) +\n  annotate(\"text\",x=-3, y=.16, label=\"Standard Error (SE)\\n(standard deviation of\\nsampling distribution)\", col=\"grey30\")+\n  geom_curve(aes(x=-3, xend=-.5, y=.18, yend=.15), col=\"grey30\", size=0.5, curvature = -0.5, arrow = arrow(length = unit(0.03, \"npc\")))+\n\n  scale_y_continuous(NULL,breaks=NULL)+\n  theme_minimal()+\n  scale_x_continuous(\"sample means under the null hypothesis\",breaks=NULL) \n  \n  \n\n```\n\nIn USMR, we saw various ways in which this logic was applied, combining the observed sample statistic with the standard error to create a _test statistic_ ($z$, $t$, $\\chi^2$, $F$, then compared to the appropriate standard distribution). \n\nIn the linear models we were making with `lm()`, these were $t$ (for the coefficient estimate) and $F$ (the reduction in residual sums of squares) tests, and accordingly they had an associated degrees of freedom. If we fit a linear model `lm(y~x)` to 10 datapoints, then our tests would have $10-2=8$^[$n$ observations minus $k$ parameters (slope of `x`) minus 1 intercept] degrees of freedom, and test statistics would be compared against, e.g. a $t$ distribution with 8 degrees of freedom. Alternatively, if we fit the same model to 100 datapoints, we would be working with a distribution with 98 degrees of freedom. The degrees of freedom reflects the fact that there is more variability in statistics from smaller samples.  \n\nAnother way of thinking of degrees of freedom is that they are the number of independent datapoints that are left \"free to vary\" around our model parameters. \n\nBut we are now working with multilevel data, and in the scenario where we have, e.g. $n_p$ pupils clustered into $n_s$ schools, how many independent bits of information do we have to begin with? $n_p$? $n_s$? somewhere in between? Our random effects are not \"free to vary\" in the sense that they are estimated under certain constraints (such as following a normal distribution).  \n\nIn very specific situations that correspond to classical experimental designs (in which, e.g., we have perfectly balanced numbers across experimental factors and equal sizes within groups) it is possible to conduct similar $F$ tests (and so $t$ too) with a calculable degrees of freedom. Unfortunately, transferring this to more general scenarios (any missing data, unbalanced designs, more complex random effect structures) is problematic. Partly because defining the degrees of freedom is much more tricky, and partly because the test statistic may not even follow an $F$ distribution with _any_ degrees of freedom.  \n\nHowever, there are various strategies that we can use to conduct inferences that either attempt to approximate the degrees of freedom, or use an alternative method based on, e.g., likelihoods or bootstrapping.  \n\nBelow, we'll go through each method in R, applying it to the following model (recall this is the model we ended with in reading [1B](01b_lmm.html#a-more-complex-model){target=\"_blank\"}).  \n\n```{r}\nlibrary(tidyverse)\nlibrary(lme4)\n\nschoolmot <- read_csv(\"https://uoepsy.github.io/data/schoolmot.csv\")\n\nsmod3 <- lmer(grade ~ motiv * funding + \n                (1 + motiv | schoolid), \n              data = schoolmot)\n```\n\n\n::: {.callout-tip collapse=\"true\"}\n#### df approximations (Satterthwaite & KR)\n\nTwo methods have been suggested as approximations for the denominator degrees of freedom for multilevel models.  \n\n\nsatterthwaite\n\nkr \n```{r}\n#| eval: false\n# ddf ----\nd3=slice_sample(d3,prop=.78)\nm0 =lmer(ACE ~ visit + condition + (1+visit|ppt), d3,REML=F)\nm0r =lmer(ACE ~ visit + condition + (1+visit|ppt), d3,REML=T)\nm1 =lmer(ACE ~ visit * condition + (1+visit|ppt), d3,REML=F)\nm1r =lmer(ACE ~ visit * condition + (1+visit|ppt), d3,REML=T)\nSATmodcomp(m1,m0) # refits with REML\nSATmodcomp(m1r,m0r) # refits with REML\nKRmodcomp(m1,m0) # refits with REML\nKRmodcomp(m1r,m0r) # refits with REML\n\n\nSATmodcomp(m1,m0) # refits with REML\nKRmodcomp(m1,m0) # refits with REML\n\nparameters::model_parameters(m1, ci_method=\"kr\")\n# CIs computed via REML, estimates, t, p not unless initial model fitted with REML\nparameters::model_parameters(m1r,ci_method=\"sat\")\n# CIs computed via REML, estimates, t, p not unless initial model fitted with REML\n```\n\n:::\n\n\n::: {.callout-tip collapse=\"true\"}\n#### likelihood based methods \n\n\n:::\n\n\n\n::: {.callout-tip collapse=\"true\"}\n#### parametric bootstrap\n\n\n:::\n\n\ntable!  \n\n\n\n\n\n\n\n\n\n\n\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"include-in-header":["assets/toggling.html"],"number-sections":false,"output-file":"02a_inference.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.340","toc_float":true,"link-citations":true,"theme":["united","assets/style-labs.scss"],"title":"Inference for LMM","params":{"SHOW_SOLS":false,"TOGGLE":true},"editor_options":{"chunk_output_type":"console"}},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}