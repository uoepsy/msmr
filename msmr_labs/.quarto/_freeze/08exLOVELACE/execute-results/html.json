{
  "hash": "6b991078a310cf1c343d6896cdc1b65b",
  "result": {
    "markdown": "---\ntitle: \"Week 8 Exercises: CFA\"\nparams: \n    SHOW_SOLS: FALSE\n    TOGGLE: TRUE\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n\n:::frame\n__New packages__  \n\nMake sure you have these packages installed:  \n\n+ lavaan\n+ semPlot\n\n:::\n\n::: {.callout-note collapse=\"true\"}\n#### the language of diagrams\n\nIt is common to think about confirmatory factor models (and structural equation models, which we will go on to learn about) in terms of the connections between variables when drawn on a whiteboard (*and* those that are left undrawn). By representing a theoretical model as paths to and from different variables, we open up a whole new way of thinking about how we model the world around us. These _\"path diagrams\"_ have different shapes and symbols to denote the covariances, regressions, observed variables and latent variables.  \n\n- **Observed variables** are represented by squares or rectangles. These are the named variables of interest which exist in our dataset - i.e. the ones which we have measured directly. \n- **Latent variables** are represented as ovals/ellipses or circles. These are unobserved variables that we can only reason about and have not (or cannot) directly measured.  \n- **Covariances** are represented by double-headed arrows. In many diagrams these are curved.  \n- **Regressions** are shown by single headed arrows (e.g., an arrow from $x$ to $y$ for the path $y \\sim x$). **Factor loadings** are also regression paths - specifying a factor structure is simply to say that some measured variables $y_1\\,,\\, ...\\, ,\\, y_k$ are each regressed onto some unmeasured factor(s). The formula $y_1 = \\lambda_1 \\cdot F + u_1$ looks an awful lot like $y = b \\cdot x + \\epsilon$, we just do not observe $F$!.  \n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![Path/SEM diagrams contain various shapes and symbols to represent different types of variable and the relationships between them.](images/semdiag.png){#fig-diagsem fig-align='center' width=80%}\n:::\n:::\n\n\n:::\n\n\n::: {.callout-note collapse=\"true\"}\n#### PCA as a diagram\n\nPCA represented as a diagram. Note that the idea of a 'composite' requires us to use a special shape (the hexagon), but many people would just use a square.\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](images/diag_pca.png){fig-align='center' width=100%}\n:::\n:::\n\n\n\n::: {.callout-caution collapse=\"true\"}\n#### optional: PCA in full\n\nPrincipal components sequentially capture the orthogonal (i.e., perpendicular) dimensions of the dataset with the most variance. The data reduction comes when we retain fewer components than we have dimensions in our original data. So if we were being pedantic, the diagram for PCA would look something like the diagram below. If the idea of 'dimensions' of a dataset is still a bit confusing, you can see a fun 3-dimensional explanation here: [PCA in 3D](00_pca.html){target=\"_blank\"}\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](images/diag_pca2.png){fig-align='center' width=100%}\n:::\n:::\n\n\n:::\n\n:::\n::: {.callout-note collapse=\"true\"}\n#### EFA as a diagram\n\nExploratory Factor Analysis as a diagram has arrows going from the factors to the observed variables. Unlike PCA, we also have 'uniqueness' factors for each variable, representing the various stray causes that are specific to each variable. Sometimes, these uniqueness are represented by an arrow only, but they are technically themselves latent variables, and so can be drawn as circles. \n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](images/diag_efa1.png){fig-align='center' width=100%}\n:::\n:::\n\n\nWhen we apply a rotation to an EFA, we make it so that some loadings are smaller and some are higher - essentially creating a 'simple structure' (where each variable loads strongly on only one factor and weakly on all other factors). This structure simplifies the interpretation of factors, making them more distinct and easily understandable. With oblique rotations, we also allow factors to be correlated, as indicated by the double headed arrow between them in the diagram below\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](images/diag_efa2.png){fig-align='center' width=100%}\n:::\n:::\n\n\n:::\n::: {.callout-note collapse=\"true\"}\n#### CFA as a diagram\n\nThe diagram for a Confirmatory Factor Analysis model looks very similar to that of an exploratory factor analysis, but we now have the explicit absence of some arrows - i.e. a variable loads on to a specific factor (or factor**s** - we can have a variable that loads on multiple), and **not** on others.  \n\nNote that this is a change from the 'exploratory' nature of EFA, to a situation in which we are explicitly imposing a theoretical model on the data.  \n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](images/diag_cfa.png){fig-align='center' width=100%}\n:::\n:::\n\n\n:::\n\n\n# conduct problems\n\n:::frame\n__Data: Conduct Problems Dataset2__  \n\nLast week we conducted an exploratory factor analysis of a dataset to try and identify an optimal factor structure for a new measure of conduct (i.e., antisocial behavioural) problems. This week, we'll conduct some confirmatory factor analyses (CFA) of the same inventory. \n\nWe have administered our measure to a new sample of n=600 adolescents. \n\nWe have re-ordered the questionnaire items to be grouped into the two types of behaviours:\n\n::::{.columns}\n:::{.column width=\"47.5%\"}\n__Non-Aggressive Behaviours__  \n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> item </th>\n   <th style=\"text-align:left;\"> behaviour </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> item 1 </td>\n   <td style=\"text-align:left;\"> Stealing </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item 2 </td>\n   <td style=\"text-align:left;\"> Lying </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item 3 </td>\n   <td style=\"text-align:left;\"> Skipping school </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item 4 </td>\n   <td style=\"text-align:left;\"> Vandalism </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item 5 </td>\n   <td style=\"text-align:left;\"> Breaking curfew </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n:::\n:::{.column width=\"5%\"}\n:::\n:::{.column width=\"47.5%\"}\n__Aggressive Behaviours__  \n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> item </th>\n   <th style=\"text-align:left;\"> behaviour </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> item 6 </td>\n   <td style=\"text-align:left;\"> Threatening others </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item 7 </td>\n   <td style=\"text-align:left;\"> Bullying </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item 8 </td>\n   <td style=\"text-align:left;\"> Spreading malicious rumours </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item 9 </td>\n   <td style=\"text-align:left;\"> Using a weapon </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item 10 </td>\n   <td style=\"text-align:left;\"> Fighting </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n:::\n::::\n\nThe data are available as a **.csv** at [https://uoepsy.github.io/data/conduct_problems_2.csv](https://uoepsy.github.io/data/conduct_problems_2.csv) \n\n:::\n\n\n\n\n<div class='question-begin'>Question 1</div><div class='question-body'>\n\n\nRead in the data. Take a look at the correlation matrix.  \n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div style=\"display:none;\">\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncp2 <- read_csv(\"https://uoepsy.github.io/data/conduct_problems_2.csv\")\n\ncor(cp2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           item1     item2      item3     item4     item5      item6     item7\nitem1  1.0000000 0.5254249 0.43498606 0.4831121 0.5644047 0.13450795 0.2806369\nitem2  0.5254249 1.0000000 0.50099054 0.5119842 0.6740107 0.15239358 0.3031997\nitem3  0.4349861 0.5009905 1.00000000 0.4897339 0.5990709 0.09463966 0.2557407\nitem4  0.4831121 0.5119842 0.48973386 1.0000000 0.6199783 0.14847703 0.2492471\nitem5  0.5644047 0.6740107 0.59907089 0.6199783 1.0000000 0.11353641 0.3112458\nitem6  0.1345080 0.1523936 0.09463966 0.1484770 0.1135364 1.00000000 0.5461757\nitem7  0.2806369 0.3031997 0.25574075 0.2492471 0.3112458 0.54617567 1.0000000\nitem8  0.2576481 0.2748175 0.19355398 0.2553712 0.2463290 0.59441335 0.8009591\nitem9  0.2444337 0.2759875 0.20798523 0.2260156 0.2333758 0.36915878 0.5988582\nitem10 0.1783069 0.1618631 0.12924914 0.1433759 0.1394748 0.46316014 0.5316143\n           item8     item9    item10\nitem1  0.2576481 0.2444337 0.1783069\nitem2  0.2748175 0.2759875 0.1618631\nitem3  0.1935540 0.2079852 0.1292491\nitem4  0.2553712 0.2260156 0.1433759\nitem5  0.2463290 0.2333758 0.1394748\nitem6  0.5944133 0.3691588 0.4631601\nitem7  0.8009591 0.5988582 0.5316143\nitem8  1.0000000 0.6169829 0.5557168\nitem9  0.6169829 1.0000000 0.3613253\nitem10 0.5557168 0.3613253 1.0000000\n```\n:::\n:::\n\n\nJust from the visual, it looks like the same factor structure is present in this sample.  \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(ggcorrplot)\nggcorrplot(cor(cp2))\n```\n\n::: {.cell-output-display}\n![](08exLOVELACE_files/figure-html/unnamed-chunk-11-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n<div class='question-begin'>Question 2</div><div class='question-body'>\n\n\nFit a 2 factor model in __lavaan__.  \n\n\n::: {.callout-note collapse=\"true\"}\n#### The lavaan package\n\nFor the remaining weeks of the course, we're going to rely heavily on the **lavaan** (**La**tent **Va**riable **An**alysis) package. \nThis is the main package in R for fitting structural equation models, and there is a huge scope of what we can do with it.  \n\n__Operators in lavaan__  \n  \nThe first thing to get to grips with is the various new operators which __lavaan__ allows us to use.   \n\nOur standard multiple regression formula in R was specified as \n\n```\ny ~ x1 + x2 + x3 + ...\n```\n\nIn lavaan, we continue to fit regressions using the `~` symbol, but we can also specify the construction of latent variables using `=~` and residual variances & covariances using `~~`.  \n\n|  Formula type|  Operator|  Mnemonic|\n|--:|--:|--:|\n|  latent variable definition|  `=~`|  \"is measured by\"|\n|  regression|  `~`|  \"is regressed on\"|\n|  (residual) (co)variance |  `~~`|  \"is correlated with\"|\n|  intercept |  `~1`|  \"has an intercept\"|\n|  defined parameters | `:=` | \"is defined as\" |\n\n(from https://lavaan.ugent.be/tutorial/syntax1.html) \n\n__Fitting models with lavaan__\n\nIn practice, fitting models in lavaan tends to be a little different from things like `lm()` and `(g)lmer()`. Instead of including the model formula *inside* the fit function (e.g., `lm(y ~ x1 + x2, data = df)`), we tend to do it in a step-by-step process. This is because as our models become more complex, our formulas can pretty long!   \n\nIn lavaan, it is typical to write the model as a character string (e.g. `model <- \"y ~ x1 + x2\"`) and then we pass that formula along with the data to the relevant __lavaan__ function such as `cfa()` or `sem()`, giving it the formula and the data: `cfa(model, data = mydata)`.  \n\n1. Specify the model:  \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmymodel <- \"\n  factor1 =~ item1 + item2 + .....\n  factor2 =~ item6 + ...... \n  ...\n  ..\n\"\n```\n:::\n\n2. Estimate the model (other fitting functions include `sem()`, `growth()` and `lavaan()`):\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmymodelfit <- cfa(mymodel, data = mydata)\n```\n:::\n\n3. Examine the fitted model: \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummary(mymodelfit)\n```\n:::\n\n\n:::\n  \n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div style=\"display:none;\">\n\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n<div class='question-begin'>Question 3</div><div class='question-body'>\n\n\n\n- examine fit\n  - box, df and model fit\n  - box fit measures\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div style=\"display:none;\">\n\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n\n<div class='question-begin'>Question 4</div><div class='question-body'>\n\n\n\n- for comparison, fit a 1 factor model and examine fit\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div style=\"display:none;\">\n\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n  \n\n\n<div class='question-begin'>Question 5</div><div class='question-body'>\n\n\n\n- return to 2 factor model. local misfit?\n  - box modindices\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div style=\"display:none;\">\n\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n\n<div class='question-begin'>Question 6</div><div class='question-body'>\n\n\nsemplot sempaths\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div style=\"display:none;\">\n\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n\n<div class='question-begin'>Question 7</div><div class='question-body'>\n\n\n\n- write up\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div style=\"display:none;\">\n\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n  \n\n\n\n\n# dimensions of apathy in adolescents\n\n:::frame\n__Dataset: das_SPS.csv__  \n\n\nFor numerous inmates, the primary goal of incarceration is rehabilitation, aimed at decreasing the likelihood of repeat offenses. However, several barriers hinder individuals' receptiveness to rehabilitation programs, among them being prisoner apathy - characterized by a lack of interest, motivation, or concern.\n\n\nevaluate the invariance of the dimension of apathy in the prison population\n\nDAS developed on healthy adults, and has been widely used in patients with neurodegenerative diseases. \n\nhere we're interested in the utility of the DAS as a measure of apathy in the prison population.\n\nscale has 3 domains:\n\nexecutive\nemotional\nbehavioural/cognitive initiation\n\n\n:::\n\n\n\n\n<div class='question-begin'>Question 8</div><div class='question-body'>\n\n\nassess whether the 3 apathy dimensions provide a good fit to the data  \nif they don't, how so?  \n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div style=\"display:none;\">\n\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n\n\n\n\n\n\n<div class='question-begin'>Question 9</div><div class='question-body'>\n\n\nExplore potential sources of model misspecification or methodological limitations that may affect the interpretation of the factor structure. Consider factors such as item wording, response scale, sample characteristics, and cultural differences that could influence respondents' interpretations and responses to the measurement items. Discuss strategies for addressing or mitigating these sources of bias or error in future research.\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div style=\"display:none;\">\n\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\nDiscuss the practical implications of the findings for psychological assessment and measurement. Consider how the results of the confirmatory factor analysis inform our understanding of the latent constructs being assessed and their relevance for theory development, clinical practice, or intervention design. Highlight any implications for future research directions or the refinement of measurement instruments based on the analysis results.\n\n\n\n\n",
    "supporting": [
      "08exLOVELACE_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/panelset-0.2.6/panelset.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/panelset-0.2.6/panelset.js\"></script>\r\n<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\r\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}