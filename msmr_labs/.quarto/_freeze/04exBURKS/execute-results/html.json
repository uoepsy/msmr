{
  "hash": "1656b5ec92551b9c33187b07925f0866",
  "result": {
    "markdown": "---\ntitle: \"Week 4 Exercises: Nested and Crossed\"\nparams: \n    SHOW_SOLS: TRUE\n    TOGGLE: TRUE\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n\n\n# Psychoeducation Treatment Effects\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\n\n:::frame\n__Data: gadeduc.csv__\n\n\n\n\n\nThis is synthetic data from a randomised controlled trial, in which 30 therapists randomly assigned participants (each therapist saw between 4 and 30 patients) to a control or treatment group, and monitored the participants' scores over time on a measure of generalised anxiety disorder (GAD7 - a 7 item questionnaire with 5 point likert scales).  \nThe control group of participants received standard sessions offered by the therapists. \nFor the treatment group, 10 mins of each sessions was replaced with a specific psychoeducational component, and participants were given relevant tasks to complete between each session. All participants had monthly therapy sessions. Generalised Anxiety Disorder was assessed at baseline and then every visit over 4 months of sessions (5 assessments in total).  \n\nThe data are available at [https://uoepsy.github.io/data/msmr_gadeduc.csv](https://uoepsy.github.io/data/msmr_gadeduc.csv){target=\"_blank\"}\n\nYou can find a data dictionary below:\n\n::: {#tbl-msmr_gadeduc.csv .cell layout-align=\"center\" tbl-cap='Data Dictionary: msmr_gadeduc.csv'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> variable </th>\n   <th style=\"text-align:left;\"> description </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> patient </td>\n   <td style=\"text-align:left;\"> A patient code in which the labels take the form &lt;Therapist initials&gt;_&lt;group&gt;_&lt;patient number&gt;. </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> visit_0 </td>\n   <td style=\"text-align:left;\"> Score on the GAD7 at baseline </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> visit_1 </td>\n   <td style=\"text-align:left;\"> GAD7 at 1 month assessment </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> visit_2 </td>\n   <td style=\"text-align:left;\"> GAD7 at 2 month assessment </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> visit_3 </td>\n   <td style=\"text-align:left;\"> GAD7 at 3 month assessment </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> visit_4 </td>\n   <td style=\"text-align:left;\"> GAD7 at 4 month assessment </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n:::\n\n\n\n\n<div class='question-begin'>Question 1</div><div class='question-body'>\n\n\n\n- read in the data. uh-oh... this isn't data in the same shape as we've been giving you thus far.  \n- can you get it into a suitable format for modelling?  \n\n\n::: {.callout-tip collapse=\"true\"}\n#### Hints\n\n- it's wide, and we want it long\n- once it's long. \"visit_0\", \"visit_1\",.. needs to become the numbers 0, 1, ...\n- one variable (`patient`) contains lots of information that we want to separate out.     \n`data |> separate(variable, into=c(\"thing1\",\"thing2\",\"thing3\",...), sep = \"separator\")`  \n\n\n:::\n\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><button id='sol-start-1' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-1', 'sol-start-1')\">  1 - reshaping</button></div><div class=\"solution-body\" id = \"sol-body-1\" style=\"display: none;\">\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngeduc = read_csv(\"../../data/msmr_gadeduc.csv\")\n\ngeduc |> \n  pivot_longer(2:last_col(), names_to=\"visit\",values_to=\"GAD\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2,600 × 3\n   patient      visit     GAD\n   <chr>        <chr>   <dbl>\n 1 OT_Control_1 visit_0    26\n 2 OT_Control_1 visit_1    27\n 3 OT_Control_1 visit_2    27\n 4 OT_Control_1 visit_3    27\n 5 OT_Control_1 visit_4    27\n 6 OT_Control_2 visit_0    25\n 7 OT_Control_2 visit_1    24\n 8 OT_Control_2 visit_2    27\n 9 OT_Control_2 visit_3    26\n10 OT_Control_2 visit_4    25\n# ℹ 2,590 more rows\n```\n:::\n:::\n\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><button id='sol-start-2' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-2', 'sol-start-2')\">  2 - time is numeric</button></div><div class=\"solution-body\" id = \"sol-body-2\" style=\"display: none;\">\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngeduc |> \n  pivot_longer(2:last_col(), names_to=\"visit\",values_to=\"GAD\") |>\n  mutate(\n    visit = as.numeric(gsub(\"visit_\",\"\",visit))\n  ) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2,600 × 3\n   patient      visit   GAD\n   <chr>        <dbl> <dbl>\n 1 OT_Control_1     0    26\n 2 OT_Control_1     1    27\n 3 OT_Control_1     2    27\n 4 OT_Control_1     3    27\n 5 OT_Control_1     4    27\n 6 OT_Control_2     0    25\n 7 OT_Control_2     1    24\n 8 OT_Control_2     2    27\n 9 OT_Control_2     3    26\n10 OT_Control_2     4    25\n# ℹ 2,590 more rows\n```\n:::\n:::\n\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><button id='sol-start-3' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-3', 'sol-start-3')\">  3 - splitting up the patient variable</button></div><div class=\"solution-body\" id = \"sol-body-3\" style=\"display: none;\">\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngeduc_long <- geduc |> \n  pivot_longer(2:last_col(), names_to=\"visit\",values_to=\"GAD\") |>\n  mutate(\n    visit = as.numeric(gsub(\"visit_\",\"\",visit))\n  ) |>\n  separate(patient, into=c(\"therapist\",\"group\",\"patient\"), sep=\"_\")\n\ngeduc_long\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2,600 × 5\n   therapist group   patient visit   GAD\n   <chr>     <chr>   <chr>   <dbl> <dbl>\n 1 OT        Control 1           0    26\n 2 OT        Control 1           1    27\n 3 OT        Control 1           2    27\n 4 OT        Control 1           3    27\n 5 OT        Control 1           4    27\n 6 OT        Control 2           0    25\n 7 OT        Control 2           1    24\n 8 OT        Control 2           2    27\n 9 OT        Control 2           3    26\n10 OT        Control 2           4    25\n# ℹ 2,590 more rows\n```\n:::\n:::\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n\n<div class='question-begin'>Question 2</div><div class='question-body'>\n\n\nVisualise the data. Does it look like the treatment had an effect?  \nDoes it look like it had an effect for every therapist?  \n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><button id='sol-start-4' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-4', 'sol-start-4')\">  Solution </button></div><div class=\"solution-body\" id = \"sol-body-4\" style=\"display: none;\">\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(geduc_long, aes(x = visit, y = GAD, col = group)) +\n  stat_summary(geom=\"pointrange\")\n```\n\n::: {.cell-output-display}\n![](04exBURKS_files/figure-html/unnamed-chunk-8-1.png){fig-align='center' width=80%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(geduc_long, aes(x = visit, y = GAD, col = group)) +\n  stat_summary(geom=\"pointrange\") +\n  facet_wrap(~therapist)\n```\n\n::: {.cell-output-display}\n![](04exBURKS_files/figure-html/unnamed-chunk-9-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n\n<div class='question-begin'>Question 3</div><div class='question-body'>\n\n\nfit a model to test if the psychoeducational treatment is associated with more improvement in anxiety over time.  \n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><button id='sol-start-5' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-5', 'sol-start-5')\">  1 - fixed effects</button></div><div class=\"solution-body\" id = \"sol-body-5\" style=\"display: none;\">\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlmer(GAD ~ visit * group + ...\n       ...\n     data = geduc_long)\n```\n:::\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><button id='sol-start-6' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-6', 'sol-start-6')\">  2 - grouping structure</button></div><div class=\"solution-body\" id = \"sol-body-6\" style=\"display: none;\">\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlmer(GAD ~ visit * group + ...\n       ( ... | therapist) + \n       ( ... | therapist:patient),\n     data = geduc_long)\n```\n:::\n\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><button id='sol-start-7' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-7', 'sol-start-7')\">  3 - random effects</button></div><div class=\"solution-body\" id = \"sol-body-7\" style=\"display: none;\">\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmod1 <- lmer(GAD ~ visit*group + \n               (1+visit*group|therapist)+\n               (1+visit|therapist:patient),\n             geduc_long)\n```\n:::\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n<div class='question-begin'>Question 4</div><div class='question-body'>\n\n\nfor each of the models below, what is wrong or suboptimal about the random effect structure?  \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmodelA <- lmer(GAD ~ visit*group + \n               (1+visit*group|therapist)+\n               (1+visit|patient),\n             geduc_long)\n\nmodelB <- lmer(GAD ~ visit*group + \n               (1+visit*group|therapist/patient),\n             geduc_long)\n```\n:::\n\n\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><button id='sol-start-8' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-8', 'sol-start-8')\">  Solution </button></div><div class=\"solution-body\" id = \"sol-body-8\" style=\"display: none;\">\n\n\n\n- patient doesn't capture the different patients _within_ therapists. so it actually fits crossed random effects and treats all data where `patient==1` as from the same group (even if this includes several different patients' worth of data from different therapists!)\n\n- using the `/` means we have the same random slopes fitted for therapists and for patients-within-therapists. but the effect of group can't vary by patient, so this doesn't work. hence why we need to split them up into `(...|therapist)+(...|therapist:patient)`.  \n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n\n<div class='question-begin'>Question 5</div><div class='question-body'>\n\n\nlet's suppose I don't want the psychoeducation treatment, I just want the standard therapy sessions that the 'Control' group received. Which therapist should I go to?  \n\n::: {.callout-tip collapse=\"true\"}\n#### Hints\n\ndotplot.ranef.mer might help here\n\n:::\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><button id='sol-start-9' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-9', 'sol-start-9')\">  Solution </button></div><div class=\"solution-body\" id = \"sol-body-9\" style=\"display: none;\">\n\n\nWG, EQ, or EI.. \n\nwhy? they all have the most negative slope of visit  \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndotplot.ranef.mer(ranef(mod1))$therapist\n```\n\n::: {.cell-output-display}\n![](04exBURKS_files/figure-html/unnamed-chunk-14-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n\n<div class='question-begin'>Question 6</div><div class='question-body'>\n\n\nrecreate this plot.  \n\nThe faint lines represent the model estimated lines for each patient.  The points and ranges represent our fixed effect estimates and their uncertainty.  \n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](04exBURKS_files/figure-html/unnamed-chunk-15-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><button id='sol-start-10' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-10', 'sol-start-10')\">  Solution </button></div><div class=\"solution-body\" id = \"sol-body-10\" style=\"display: none;\">\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\neffplot <- effects::effect(\"visit*group\",mod1) |>\n  as.data.frame()\n\nbroom.mixed::augment(mod1) |> \n  mutate(\n    upatient = paste0(therapist,patient)\n  ) |>\n  ggplot(aes(x=visit,y=.fitted,col=group))+\n  stat_summary(geom=\"line\", aes(group=upatient,col=group), alpha=.1)+\n  geom_pointrange(data=effplot, aes(y=fit,ymin=lower,ymax=upper,col=group))+\n  labs(x=\"- Month -\",y=\"GAD7\")\n```\n\n::: {.cell-output-display}\n![](04exBURKS_files/figure-html/unnamed-chunk-16-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n<br><br>\n\n# Test Enhanced Learning\n\n:::frame\n__Data: Test-enhanced learning__  \n\nAn experiment was run to conceptually replicate \"test-enhanced learning\" (Roediger & Karpicke, 2006): two groups of 25 participants were presented with material to learn. One group studied the material twice (`StudyStudy`), the other group studied the material once then did a test (`StudyTest`). Recall was tested immediately (one minute) after the learning session and one week later. The recall tests were composed of 175 items identified by a keyword (`Test_word`). \n\nThe critical (replication) prediction is that the `StudyStudy` group should perform somewhat better on the immediate recall test, but the `StudyTest` group will retain the material better and thus perform better on the 1-week follow-up test.\n\nThe following code loads the data into your R environment by creating a variable called `tel`:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nload(url(\"https://uoepsy.github.io/data/testenhancedlearning.RData\"))\n```\n:::\n\n::: {#tbl-teldict .cell layout-align=\"center\" tbl-cap='Data Dictionary: testenhancedlearning.Rdata'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> variable </th>\n   <th style=\"text-align:left;\"> description </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Subject_ID </td>\n   <td style=\"text-align:left;\"> Unique Participant Identifier </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Group </td>\n   <td style=\"text-align:left;\"> Group denoting whether the participant studied the material twice (StudyStudy), or studied it once then did a test (StudyTest) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Delay </td>\n   <td style=\"text-align:left;\"> Time of recall test ('min' = Immediate, 'week' = One week later) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Test_word </td>\n   <td style=\"text-align:left;\"> Word being recalled (175 different test words) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Correct </td>\n   <td style=\"text-align:left;\"> Whether or not the word was correctly recalled </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Rtime </td>\n   <td style=\"text-align:left;\"> Time to recall word (milliseconds) </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n:::\n\n\n\n\n\n<div class='question-begin'>Question 7</div><div class='question-body'>\n\n\nLoad and plot the data. Does it look like the effect was replicated?  \n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><button id='sol-start-11' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-11', 'sol-start-11')\">  Solution </button></div><div class=\"solution-body\" id = \"sol-body-11\" style=\"display: none;\">\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nload(url(\"https://uoepsy.github.io/data/testenhancedlearning.RData\"))\n\nggplot(tel, aes(Delay, Correct, col=Group)) + \n  stat_summary(fun.data=mean_se, geom=\"pointrange\")+\n  theme_light()\n```\n\n::: {.cell-output-display}\n![](04exBURKS_files/figure-html/unnamed-chunk-19-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\nThat looks like test-enhanced learning to me!  \n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n<div class='question-begin'>Question 8</div><div class='question-body'>\n\n\n\nTest the critical hypothesis using a mixed-effects model.  \n\nFit the maximal random effect structure supported by the experimental design. Simplify the random effect structure until you reach a model that converges.  \n\nSome of the models you attempt here might take time to fit. This is normal, and you can cancel the estimation at any time by pressing the escape key.  \nI suggest you write your initial model, set it running, and then look at the first solution to see if it converged for me. \nAssume that if it didn't work for me, it also won't work for you. In which case cancel it and write your next model (then look at the next solution as that model is fitting, and so on.. )  \n\n::: {.callout-tip collapse=\"true\"}\n#### Hints\n\nWhat we're aiming to do here is to follow [Barr et al.'s](https://doi.org/10.1016/j.jml.2012.11.001) advice of defining our maximal model and then removing only the terms to allow a non-singular fit.  \n\n+ What kind of model will you use? What is our outcome? is it binary, or continuous? \n+ We can expect variability across subjects (some people are better at learning than others) and across items (some of the recall items are harder than others). How should this be represented in the random effects?\n\n:::\n\n\n\n</div><p class=\"question-end\"></p>\n\n \n\n\n<div class=\"solution-begin\"><button id='sol-start-12' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-12', 'sol-start-12')\">  1 - maximal model</button></div><div class=\"solution-body\" id = \"sol-body-12\" style=\"display: none;\">\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\nThis one took my computer about 6 minutes.  \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmod1 <- glmer(Correct ~ Delay*Group +\n             (1 + Delay | Subject_ID) +\n             (1 + Delay * Group | Test_word),\n             family=binomial, data=tel)\n```\n:::\n\n<p style=\"color:red;font-size:.8em\">\nWarning message:<br>\nIn checkConv(attr(opt, \"derivs\"), opt\\$par, ctrl = control\\$checkConv,  :<br>\n  Model failed to converge with max|grad| = 0.0184773 (tol = 0.002, component 1)\n</p>\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nVarCorr(mod1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Groups     Name                     Std.Dev. Corr                \n Test_word  (Intercept)              1.057208                     \n            Delayweek                0.059611 -0.341              \n            GroupStudyTest           0.067625 -0.835  0.802       \n            Delayweek:GroupStudyTest 0.115439 -0.783  0.852  0.996\n Subject_ID (Intercept)              1.594518                     \n            Delayweek                0.210026 -0.623              \n```\n:::\n:::\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><button id='sol-start-13' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-13', 'sol-start-13')\">  2 - Removing Group|Subject_ID</button></div><div class=\"solution-body\" id = \"sol-body-13\" style=\"display: none;\">\n\n\n\nlets remove the interaction in the by-word random effects.  \nThis one took about 5 minutes...\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmod2 <- glmer(Correct ~ Delay*Group +\n             (1 + Delay | Subject_ID) +\n             (1 + Delay + Group | Test_word),\n             family=binomial, data=tel)\n```\n:::\n\n<p style=\"color:red;font-size:.8em\">\nWarning message:<br>\nIn checkConv(attr(opt, \"derivs\"), opt\\$par, ctrl = control\\$checkConv,  :<br>\n  Model failed to converge with max|grad| = 0.00887744 (tol = 0.002, component 1)\n</p>\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nVarCorr(mod2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Groups     Name           Std.Dev. Corr         \n Test_word  (Intercept)    1.076941              \n            Delayweek      0.074697 -0.801       \n            GroupStudyTest 0.109342 -0.928  0.966\n Subject_ID (Intercept)    1.589794              \n            Delayweek      0.210633 -0.601       \n```\n:::\n:::\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><button id='sol-start-14' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-14', 'sol-start-14')\">  3 - Removing Group|Test_word</button></div><div class=\"solution-body\" id = \"sol-body-14\" style=\"display: none;\">\n\n\n\nWe still have a singular fit here. Thinking about the study, if we are going to remove __one__ of the by-testword random effects (`Delay` or `Group`), which one do we consider to be more theoretically justified? Is the effect of Delay likely to vary by test-words? More so than the effect of group is likely to vary by test-words? Quite possibly - there's no obvious reason for _certain_ words to be more memorable for people in one group vs another. But there is reason for words to vary in the effect that delay of one week has - how familiar a word is will likely influence the amount to which a week's delay has on recall.   \n\nLet's remove the by-testword random effect of group. \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmod3 <- glmer(Correct ~ Delay*Group +\n             (1 + Delay | Subject_ID) +\n             (1 + Delay | Test_word),\n             family=binomial, data=tel)\n```\n:::\n\n\nThis one converges! But we still have a correlation of -1. Why did we not get a warning message?  \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nVarCorr(mod3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Groups     Name        Std.Dev. Corr  \n Test_word  (Intercept) 1.027514       \n            Delayweek   0.055424 -1.000\n Subject_ID (Intercept) 1.598967       \n            Delayweek   0.208732 -0.599\n```\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nisSingular(mod3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] FALSE\n```\n:::\n:::\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><button id='sol-start-15' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-15', 'sol-start-15')\">  4 - Removing Delay|Test_word</button></div><div class=\"solution-body\" id = \"sol-body-15\" style=\"display: none;\">\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmod4 <- glmer(Correct ~ Delay*Group +\n             (1 + Delay | Subject_ID) +\n             (1 | Test_word),\n             family=binomial, data=tel)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nisSingular(mod4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] FALSE\n```\n:::\n:::\n\n\n\n\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><button id='sol-start-16' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-16', 'sol-start-16')\">  5 - Comparisons</button></div><div class=\"solution-body\" id = \"sol-body-16\" style=\"display: none;\">\n\n\n\nHere are the fixed effects from each model: \n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 5\n  term                       mod1   mod2   mod3   mod4\n  <chr>                     <dbl>  <dbl>  <dbl>  <dbl>\n1 (Intercept)               1.28   1.28   1.27   1.26 \n2 Delayweek                -1.06  -1.07  -1.06  -1.05 \n3 GroupStudyTest           -0.415 -0.429 -0.401 -0.398\n4 Delayweek:GroupStudyTest  0.781  0.795  0.776  0.776\n```\n:::\n:::\n\n\nAnd here are the standard errors of fixed effects for each model:  \n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 5\n  term                       mod1   mod2   mod3   mod4\n  <chr>                     <dbl>  <dbl>  <dbl>  <dbl>\n1 (Intercept)              0.332  0.331  0.332  0.329 \n2 Delayweek                0.0707 0.0707 0.0697 0.0675\n3 GroupStudyTest           0.456  0.454  0.457  0.453 \n4 Delayweek:GroupStudyTest 0.103  0.102  0.101  0.0992\n```\n:::\n:::\n\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n \n\n\n\n\n\n<div class='question-begin'>Question 9</div><div class='question-body'>\n\n\nCreate a plot of the fixed effects.  \n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><button id='sol-start-17' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-17', 'sol-start-17')\">  Solution </button></div><div class=\"solution-body\" id = \"sol-body-17\" style=\"display: none;\">\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(effects)\neffplot <- effect(\"Delay:Group\", mod4) |>\n  as.data.frame()\n\nggplot(effplot, aes(Delay, fit, color=Group)) + \n  geom_pointrange(aes(ymax=upper, ymin=lower), \n                  position=position_dodge(width = 0.2))+\n  theme_classic() # just for a change :)\n```\n\n::: {.cell-output-display}\n![](04exBURKS_files/figure-html/unnamed-chunk-32-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n\n<div class='question-begin'>Question 10</div><div class='question-body'>\n\n\nWhat should we do with this information? How can we apply test-enhanced learning to learning R and statistics?\n\n\n</div><p class=\"question-end\"></p>\n\n \n\n\n<div class=\"solution-begin\"><button id='sol-start-18' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-18', 'sol-start-18')\">  Solution </button></div><div class=\"solution-body\" id = \"sol-body-18\" style=\"display: none;\">\n\n\nYou'll get the benefits of test-enhanced learning if you try yourself before looking at the solutions! If you don't test yourself, you're more likely to forget it in the long run. \n\n\n</div><p class=\"solution-end\"></p>\n\n \n\n<br><br>\n\n# Vocab Development\n\n\n\n\n:::frame\n__Data: pvt_bilingual.csv__ \n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n337 children from 30 schools were included in the study. Children were assessed on a yearly basis for 7 years throughout primary school on a measure of vocabulary administered in English, the Picture Vocab Test (PVT). 195 were monolingual English speakers, and 142 were bilingual (english + another language). \n\nPrevious research conducted on monolingual children has suggested that that scores on the PVT increase steadily up until the age of approximately 7 or 8 at which point they begin to plateau. The aim of the present study is to investigate differences in the development of vocabulary between monolingual and bilingual children.  \n\nThe data are available at [https://uoepsy.github.io/data/pvt_bilingual.csv](https://uoepsy.github.io/data/pvt_bilingual.csv).  \n\n\n::: {#tbl-pvtdict .cell layout-align=\"center\" tbl-cap='Data Dictionary: pvt_bilingual.csv'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> variable </th>\n   <th style=\"text-align:left;\"> description </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> child </td>\n   <td style=\"text-align:left;\"> Child's name </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> school </td>\n   <td style=\"text-align:left;\"> School Identifier </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> isBilingual </td>\n   <td style=\"text-align:left;\"> Binary variable indicating whether the child is monolingual (0) or bilingual (1) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> age </td>\n   <td style=\"text-align:left;\"> Age (years) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> PVT </td>\n   <td style=\"text-align:left;\"> Score on the Picture Vocab Test (PVT). Scores range 0 to 60 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n:::\n\n\n\n<div class='question-begin'>Question 11</div><div class='question-body'>\n\n\nLet's start by thinking about our clustering - we'd like to know how much of the variance in PVT scores is due to the clustering of data within children, who are themselves within schools. One easy way of assessing this is to fit an _intercept only_ model, which has the appropriate random effect structure.  \n\nUsing the model below, calculate the proportion of variance attributable to the clustering of data within children within schools.  \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npvt_null <- lmer(PVT ~ 1 +  (1 | school/child), data = pvt)\n```\n:::\n\n\n::: {.callout-tip collapse=\"true\"}\n#### Hints\nthe random intercept variances are the building blocks here. There are no predictors in this model, so all the variance in the outcome gets attributed to either school-level nesting, child-level nesting, or else is lumped into the residual.   \n:::\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><button id='sol-start-19' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-19', 'sol-start-19')\">  Solution </button></div><div class=\"solution-body\" id = \"sol-body-19\" style=\"display: none;\">\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# pvt <- read_csv(\"../../data/bntmono.csv\")\npvt_null <- lmer(PVT ~ 1 +  (1 | school/child), data = pvt)\nsummary(pvt_null)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLinear mixed model fit by REML ['lmerMod']\nFormula: PVT ~ 1 + (1 | school/child)\n   Data: pvt\n\nREML criterion at convergence: 14202.3\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-3.7044 -0.6042  0.0163  0.5692  4.1122 \n\nRandom effects:\n Groups       Name        Variance Std.Dev.\n child:school (Intercept) 31.78    5.637   \n school       (Intercept) 20.74    4.554   \n Residual                 45.01    6.709   \nNumber of obs: 2051, groups:  child:school, 293; school, 30\n\nFixed effects:\n            Estimate Std. Error t value\n(Intercept)  27.7752     0.9113   30.48\n```\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\nAs we can see from `summary(bnt_null)`, the random intercept variances are 31.78 for child-level, 20.74 for school-level, and the residual variance is 45.01.  \n\nSo child level differences account for $\\frac{31.78}{31.78 + 20.74 + 45.01} = 0.33$ of the variance in PVT scores, and child & school differences together account for $\\frac{31.78 + 20.74}{31.78 + 20.74 + 45.01} = 0.54$ of the variance.  \n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n<div class='question-begin'>Question 12 - Less Guided</div><div class='question-body'>\n\n\nConduct an analysis to estimate the differences in trajectories of vocabulary development between children attending bilingual schools vs those attending monolingual schools.  \n\nWrite up your results.  \n\n\n::: {.callout-tip collapse=\"true\"}\n#### Hints\n\n- make things factors\n- always plot your data!\n- \n\n:::\n\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><button id='sol-start-20' class=\"jk-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-20', 'sol-start-20')\">  Solution </button></div><div class=\"solution-body\" id = \"sol-body-20\" style=\"display: none;\">\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(pvt, aes(x=age,y=PVT,col=factor(isBilingual)))+\n  stat_summary(geom=\"pointrange\")+\n  stat_summary(geom=\"line\")\n```\n\n::: {.cell-output-display}\n![](04exBURKS_files/figure-html/unnamed-chunk-38-1.png){fig-align='center' width=80%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npvt <- pvt |> mutate(\n  poly1 = poly(age, 3)[,1],\n  poly2 = poly(age, 3)[,2],\n  poly3 = poly(age, 3)[,3],\n  isBilingual = factor(isBilingual)\n)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmod1 <- lmer(PVT ~ 1 + (poly1 + poly2 + poly3) * isBilingual + \n       (1 + (poly1 + poly2 + poly3)*isBilingual | school) + \n       (1 + (poly1 + poly2 + poly3) | school:child),\n     data = pvt)\n\nmod2 <- lmer(PVT ~ 1 + (poly1 + poly2 + poly3) * isBilingual + \n       (1 + isBilingual * (poly1 + poly2) + poly3 | school) +\n       (1 + (poly1 + poly2 + poly3) | school:child),\n     data = pvt)\n\nmod3 <- lmer(PVT ~ 1 + (poly1 + poly2 + poly3) * isBilingual + \n       (1 + isBilingual * (poly1 + poly2) | school) +\n       (1 + (poly1 + poly2 + poly3) | school:child),\n     data = pvt)\n\nmod4 <- lmer(PVT ~ 1 + (poly1 + poly2 + poly3) * isBilingual + \n       (1 + isBilingual * (poly1) + poly2 | school) +\n       (1 + (poly1 + poly2 + poly3) | school:child),\n     data = pvt)\n\nmod5 <- lmer(PVT ~ 1 + (poly1 + poly2 + poly3) * isBilingual + \n       (1 + isBilingual * (poly1) | school) +\n       (1 + (poly1 + poly2 + poly3) | school:child),\n     data = pvt)\n\nmod6 <- lmer(PVT ~ 1 + (poly1 + poly2 + poly3) * isBilingual + \n       (1 + isBilingual + poly1 | school) +\n       (1 + (poly1 + poly2 + poly3) | school:child),\n     data = pvt)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmod7 <- lmer(PVT ~ 1 + (poly1 + poly2 + poly3) * isBilingual + \n       (1 + poly1 | school) +\n       (1 + (poly1 + poly2 + poly3) | school:child),\n     data = pvt)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(broom.mixed)\naugment(mod7) |> \n  mutate(\n    poly1 = round(poly1, 3) # because of rounding errors make plot weird\n  ) |>\n  ggplot(aes(x=poly1,col=isBilingual))+\n  stat_summary(geom=\"pointrange\",aes(y=PVT))+\n  stat_summary(geom=\"line\", aes(y=.fitted))\n```\n\n::: {.cell-output-display}\n![](04exBURKS_files/figure-html/unnamed-chunk-42-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n\n\n\n",
    "supporting": [
      "04exBURKS_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/panelset-0.2.6/panelset.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/panelset-0.2.6/panelset.js\"></script>\r\n<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\r\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}